<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link th:href="@{/css/style.css}" rel="stylesheet">
    <title>ホーム画面</title>
</head>
<body>
<div class="header-contents">
    <div class="header" th:if="${loginUser != null}">
        <div class="admin-wrap">
            <a class="btn-admin" th:if="${loginUser.departmentId == 1}" th:href="@{/admin/show}">管理者用</a>
        </div>
        <div class="approver-wrap">
            <a class="btn-approver" th:if="${loginUser.authority == 0}" th:href="@{/approval}">承認者用</a>
        </div>
        <div class="btn-setting">
            <a th:href="@{/password/change/{id}(id=${userId})}"><span>パスワード変更</span></a>
        </div>
        <form class="form-logout" th:action="@{/logout}" method="post">
            <input class="button-logout" type="submit" value="ログアウト">
        </form>
    </div>
</div>
<div class="main-contents">
    <h1 class="title">勤怠管理システム</h1>
    <div th:text="${errorMessage}"></div>
    <div class="user-info">
        社員番号：<span th:text="${loginUser.account}"></span>
    </div>

    <div class="action-buttons">
        <div class="btn-registration">
            <a th:href="@{/new}"><span>勤怠登録</span></a>
        </div>

        <div class="btn-application">
            <form th:if="${!alreadyApplied}" th:action="@{/application}" method="post">
                <input type="hidden" name="year" th:value="${year}">
                <input type="hidden" name="month" th:value="${month}">
                <button type="submit" onclick="return confirmApplication();"><span>申請</span></button>
            </form>

            <p th:if="${alreadyApplied}" class="applied-message">申請済みです</p>
        </div>
    </div>

    <div class="month-nav">
        <a th:href="@{'/?year=' + ${prevYear} + '&month=' + ${prevMonth}}">＜先月</a>
        <span th:text="${month} + '月'"></span>
        <a th:href="@{'/?year=' + ${nextYear} + '&month=' + ${nextMonth}}">来月＞</a>
    </div>

    <div class="application-status">
        <p th:text="${month} + '月申請状況：' + ${status}"></p>
    </div>

    <table class="attendance-list">
        <thead>
        <tr>
            <th>日付</th>
            <th>勤務開始時間</th>
            <th>勤務終了時間</th>
            <th>休憩時間</th>
            <th>労働時間</th>
            <th>超過時間</th>
            <th>コメント</th>
            <th></th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="attendance, stat : ${attendances}">
            <td th:text="${#temporals.format(attendance.workDate, 'M/d')}"></td>
            <td th:text="${#temporals.format(attendance.startTime, 'HH:mm')}"></td>
            <td th:text="${#temporals.format(attendance.endTime, 'HH:mm')}"></td>
            <td th:text="${#temporals.format(attendance.startRest, 'HH:mm')} + '〜' + ${#temporals.format(attendance.endRest, 'HH:mm')}"></td>
            <!-- 労働時間 -->
            <td th:text="${workingHour[stat.index]}"></td>
            <td th:text="${overHour[stat.index]}"></td>
            <td th:text="${attendance.comment}"></td>
            <td><a class="edit-link" th:href="@{/attendance/edit/{id}(id=${attendance.id})}">勤怠編集</a></td>
        </tr>
        </tbody>
        <tr>
            <th>合計</th>
            <th></th><th></th>
            <th>休憩時間</th>
            <th>労働時間</th>
            <th>超過時間</th>
            <th></th><th></th>
        </tr>
        <tr>
            <td></td><td></td><td></td>
            <td th:text="${totalDto.totalRestTimeFormatted}"></td>
            <td th:text="${totalDto.totalWorkTimeFormatted}"></td>
            <td th:text="${totalDto.totalOverTimeFormatted}"></td>
            <td></td><td></td>
        </tr>
    </table>
</div>
<script>
    function confirmApplication() {
        return confirm("申請しますか？");
    }
</script>
</body>
</html>